# Chapter15. 파일 시스템


## 파일과 디렉터리

### 파일(File)

* 하드디스크나 SSD와 같은 **보조기억장치에 저장된 관련 정보의 집합**
* 의미 있고 관련 있는 **정보를 모은 논리적 단위**
* 파일을 이루는 정보 : 이름, 실행을 위한 정보, 부가 정보 → 속성(Attribute), 메타데이터(Metadata)
* 파일 속성의 종류 : 유형, 크기, 보호, 날짜, 생성자, 소유자, 위치 등
* **파일 유형**
    * 운영체제가 **인식하는 파일 종류**
    * 유형이 달라지면 실행 양상도 달라짐
    * 그렇기 때문에 파일을 실행할 운영체제에 파일 유형을 알려주어야 함
    * **확장자**는 파일 유형(종류)이 무엇인지 운영체제에 알려주는 힌트
* 파일을 다루는 모든 작업은 **운영체제에 의해 이루어짐**, 응용프로그램의 임의 접근 불가
* 운영체제는 파일 생성/삭제, 열기/닫기, 읽기/쓰기와 같은 파일 연산을 위한 **시스템 콜 제공**

### 디렉터리(Directory)
* **파일들을 관리**하기 위해 사용, 윈도우 운영체제에서는 폴더(Folder)
* 여러 개의 파일 또는 디렉터리를 묶어 관리 가능
* 옛날 운영체제에서는 하나의 디렉터리만 존재, 1단계 디렉터리(Single-level Directory)
* 컴퓨터 용량이 커지며 파일 개수 증가, 여러 계층을 가진 트리 구조 디렉터리(Tree-structured Directory) 생성
* 최상위 디렉터리 하위에 여러 서브 디렉터리
* **최상위 디렉터리** : 루트 디렉터리(Root Directory), /로 표현(윈도우는 C:\)
* **경로(Path)** : 디렉터리를 이용해 파일 위치, 파일 이름을 특정 짓는 정보
    * 절대 경로(Absolute Path) : 루트 디렉터리부터 시작하는 경로
    * 상대 경로(Relative Path) : 현재 디렉터리부터 시작하는 경로
* 운영체제가 파일 연산을 위한 시스템 콜과 마찬가지로 디렉터리 연산을 위한 시스템 콜 제공
* **디렉터리 엔트리**
    * 운영체제는 디렉터리를 특별한 형태의 파일로 간주
    * 포함된 정보가 조금 특별할 뿐, 디렉터리도 파일
    * 파일 내부 : 해당 파일과 관련된 정보
    * 디렉터리 내부 : 담겨 있는 대상과 관련된 정보, 보조기억장치에 테이블 형태로 저장
    * 디렉터리 엔트리
        * 테이블 내부 행
        * 파일 이름, 내부에 저장된 위치를 유추할 수 있는 정보 포함
        * 디렉터리 엔트리만 봐도 무엇이 담겨 있는지, 보조기억장치 어디에 위치한지 추론 가능

## 파일 시스템

**파일 시스템** : 파일과 다양한 디렉터리를 보조기억장치에 저장, 접근할 수 있게 하는 운영체제 내부 프로그램
다양한 종류, 하나의 컴퓨터에서 여러 파일 시스템 사용 가능

### 파티셔닝과 포매팅
* 한 번도 사용된 적이 없는 새 보조기억장치에 곧바로 파일 생성 및 저장 불가
* 보조기억장치를 사용하려면 파티션을 나누는 작업(파티셔닝)과 포맷 작업(포매팅)이 선행되어야 함
* **파티셔닝(Partitioning)**
    * 저장 장치의 논리적인 영역을 구획하는 작업
	* ex)엄청 큰 서랍의 칸막이 설치
	* 칸막이로 **영역을 나누는 작업**
	* 용량이 큰 저장 장치를 하나 이상의 논리적인 단위로 구획
	* 파티셔닝 작업을 통해 나누어진 영역을 파티션(Partition)
* **포매팅(Formatting)**
    * '저장 장치를 완전히 삭제'는 정확한 표현이 아님
	* 파일 시스템을 설정해 어떤 방식으로 파일을 저장, 관리할지 결정
	* **새로운 데이터를 쓸 준비**를 하는 작업
	* 어떤 종류의 파일 시스템을 사용할지 이때 결정됨
	* 파티션마다 다른 파일 시스템 설정 가능

### 파일 할당 방법
* 운영체제는 파일과 디렉터리를 블록(Block) 단위로 읽고 씀 (윈도우에선 클러스터)
* 하나의 파일이 보조기억장치에 저장될 때, 하나 이상의 블록에 걸쳐 저장
* 파일을 보조기억장치에 할당하는 방법은 연속 할당과 불연속 할당
* 불연속 할당에는 크게 연결 할당, 색인 할당
* **연속 할당(Contiguous Allocation)**
    * 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식
	* 연속으로 할당된 파일에 접근하기 위해선 파일의 첫 블록 주소와 블록 단위의 길이만 알면 가능
	* 디렉터리 엔트리 내부 파일 이름, 첫번째 블록 주소, 블록 단위의 길이 명시
	* 장점 : 연속적으로 저장해 구현이 단순
	* 단점 : 외부 단편화
	* **외부 단편화**
        * 중간에 끼어있는 파일을 삭제했을 경우 빈공간 발생
		* 만약 5블록짜리 파일을 삭제했을 경우, 해당 자리에는 5블록을 넘는 파일 저장 불가
* **연결 할당(Linked Allocation)**
    * 각 블록 일부에 다음 블록의 주소를 저장해 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식
	* 파일을 이루는 데이터를 연결 리스트로 관리, 포인터
	* 불연속 할당의 일종이기 때문에 여러 블록에 흩어져 저장되어도 무방
	* 디렉터리 엔트리 내부는 연속 할당과 동일 (이름, 첫 블록 주소, 블록 길이)
	* 장점 : 외부 단편화 문제 해결
	* **연결 할당의 단점**
    * 반드시 첫번째 블록부터 하나씩 차례대로 읽어야 함
        * 파일 내 임의의 위치에 접근하는 속도 즉 임의 접근(Random Access) 속도 매우 느림
    * 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근 불가
        * 하나의 블록 안에 다음 주소 또한 포함되어 있어 하나라도 문제가 발생하면 이후 블록 접근 불가
    * 연결 할당을 조금 변형한 대표적인 파일 시스템 : FAT 파일 시스템
* **색인 할당(Indexed Allocation)**
	* 파일의 모든 주소를 색인 블록(Index Block)이라는 하나의 블록에 모아 관리하는 방식
	* 임의 접근 가능, 순차적 접근을 원한다면 색인 블록에 저장된 주소에 차례대로 접근
	* 디렉터리 엔트리 내부 파일 이름, 색인 블록 주소 명시
	* 색인 할당을 기반으로 만든 파일 시스템 : 유닉스 파일 시스템

### 파일 시스템 살펴보기
저용량 저장 장치에서 사용되는 FAT 파일 시스템, 유닉스 계열 운영체제에서 사용되는 유닉스 파일 시스템
* **FAT 파일 시스템**
	* 연결 할당의 단점을 보완한 파일 시스템
	* 연결 할당의 근본적인 문제는 블록 안에 다음 블록의 주소를 저장했기 때문
	* 각 블록에 포함된 다음 블록의 주소를 한데 모아 테이블 형태로 관리, 파일 할당 테이블(FAT; File Allocation Table)
	* 버전에 따라 FAT12, FAT16, FAT32, 뒤의 숫자는 블록을 표현하는 비트 수
	* 하드웨어 내부 FAT영역, 루트 디렉터리 영역, 데이터 영역 순서로 생성
	* FAT는 하드디스크 파티션에 있지만 실행하는 도중 메모리에 캐시 가능
	* FAT가 메모리에 적재된 상태로 실행 시 임의 접근의 성능 개선
	* 디렉터리 엔트리에는 파일 이름, 확장자, 속성, 예약 영역, 생성 시간, 마지막 접근 시간, 마지막 수정 시간, 시작 블록, 파일 크기로 구성
* **유닉스 파일 시스템**
	* 색인 할당 기반의 파일 시스템
	* 유닉스 파일 시스템에서 색인 블록을 i-node(index-node)라고 부름
	* i-node 내부에는 파일 속성 정보와 열다섯 개의 블록 주소 저장 가능(FAT는 디렉터리 엔트리에 속성 표현)
	* 파일마다 이런 i-node존재, 번호 부여
	* 하드웨어 내부 i-node 영역, 데이터 영역 순서로 생성
	* i-node의 크기는 15개로 유한하기 때문에 크기가 큰 파일은 i-node 하나만으로 파일의 데이터 블록을 모두 지정 불가
	* **해결 방안**
	    1. 블록 주소 중 12개에는 직접 블록 주소 저장
	    2. 1의 내용으로 충분하지 않다면 13번째 주소에 단일 간접 블록 주소를 저장
	    3. 2의 내용으로 충분하지 않다면 14번째 주소에 이중 간접 블록 주소를 저장
	    4. 4의 내용으로 충분하지 않다면 15번째 주소에 삼중 간접 블록 주소를 저장
        * 직접 블록(Direct Block) : 파일 데이터가 저장된 블록
		* 단일 간접 블록(Single Indirect Block) : 파일 데이터를 저장한 블록 주소가 저장된 블록
		* 이중 간접 블록(Double Indirect Block) : 단일 간접 블록들의 주소를 저장하는 블록
		* 삼중 간접 블록(Triple Indirect Block) : 이중 간접 블록들의 주소를 저장하는 블록
* 이 외에도 여러 파일 시스템 존재(윈도우의 NT 파일 시스템(NTFS), 리눅스의 ext 파일 시스템)