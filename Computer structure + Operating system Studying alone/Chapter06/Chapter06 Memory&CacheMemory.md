# Chapter06.Memory&CacheMemory

# RAM의 특징과 종류

## RAM(메모리) 특징

실행할 프로그램의 명령어와 데이터가 저장된다.

**휘발성 저장장치**라 전원 공급을 중단하면, 저장된 명령어와 데이터가 모두 사라진다.

반면에 전원이 꺼져도 저장된 내용이 유지되는 저장 장치는 **비휘발성 저장장치**라고 한다. 

ex) HDD,SSD,CD-ROM,USB 등 보조 기억 장치가 대표적

비휘발성은 보관할 대상, 휘발성은 실행할 대상

CPU가 실행하고 싶은 프로그램을 보조 기억 장치에서 RAM으로 복사한 뒤 실행

RAM 용량은 적당히 큰 것이 좋다. 필요 이상 커지면 그 때부터 용량⏫ ≠ 속도⏫

## RAM 종류

### DRAM (Dynamic RAM)

시간이 지나면 저장된 데이터가 점차 사라지는 램. 주기적인 Refresh 필요. **주로 주 기억 장치로 활용.**

![Untitled](Chapter06%20Memory&CacheMemory%204621ca6002b84225a0e1e918ca8110eb/Untitled.png)

### SRAM(Static RAM)

시간이 지나도 저장된 데이터가 변하지 않는 램. 단, 비휘발성 메모리인 것은 아니기 때문에 오랜 시간 동안 전원이 공급되지 않으면 데이터가 날아감. **주로 캐시 메모리로 활용.**

![Untitled](Chapter06%20Memory&CacheMemory%204621ca6002b84225a0e1e918ca8110eb/Untitled%201.png)

SRAM의 구조 및 원리 : [https://gdnn.tistory.com/73](https://gdnn.tistory.com/73)

비용이 낮고 대용량으로 설계하기 용이하기 때문에 일반적으로 DRAM을 사용한다.

### DRAM의 종류

**SDRAM(Synchoronous Dynamic RAM)** -클럭 신호와 동기화되어 CPU와 정보를 주고 받을 수 있는 DRAM

**DDR(Double Data Rate) SDRAM -** 데이터를 주고받는 대역폭을 넓혀 속도를 빠르게 만든 SDRAM

**DDR2 SDRAM** - DDR SDRAM의 2배

**DDR3 SDRAM** - DDR2 SDRAM의 2배

# 논리 주소와 물리 주소의 차이

### 물리 주소

메모리 하드웨어가 사용하는 주소. 정보가 실제로 저장된 하드웨어 상의 주소.

### 논리 주소

CPU와 실행 중인 프로그램이 사용하는 주소. 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소.

### 물리 주소와 논리 주소

CPU와 실행 프로그램은 모든 물리 주소를 알고 있는가?

1. 메모리에는 새롭게 실행되는 프로그램이 수시로 적재되고, 실행이 끝난 이후에는 삭제된다.
2. 같은 프로그램을 여러 번 실행하면, 그 때마다 적재되는 주소가 달라질 수 있다.
3. 이 때문에 CPU와 프로그램은 현재 메모리 상황을 모조리 알고 있기란 현실적으로 어렵다.

그렇기에 프로그램은 물리 주소 대신 모두 0번지부터 시작하는 고유의 논리 주소를 가지고 있다. CPU는 이를 해석하고 연산한다. 논리 주소는 프로그램마다 같을 수 있다. 

# 논리 주소 물리 주소 변환하는 방법

### 메모리 관리 장치(MMU)

CPU가 이해하는 주소가 논리 주소라고 해도 메모리와 상호작용을 위해 주소 간의 변환이 이루어져야 한다. 이 역할을 CPU와 주소 버스 사이에 위치한 MMU라는 하드웨어가 수행한다.

**CPU가 발생 시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환한다.** 이후 메모리에 접근한다.

**베이스 레지스터** - 프로그램의 첫 물리 주소를 저장.

**논리 주소** - 프로그램의 시작점으로 부터 떨어진 거리.

### 메모리 보호 기법

논리 주소 범위를 벗어나는 명령어를 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호하는 방법. 한계 레지스터가 담당한다.

**한계 레지스터** - 논리 주소의 최대 크기를 저장한다.

![Untitled](Chapter06%20Memory&CacheMemory%204621ca6002b84225a0e1e918ca8110eb/Untitled%202.png)

CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지 항상 검사한다. 만약 한계 레지스터보다 높은 논리 주소에 접근하려고 하면 인터럽트(트랩)를 발생시켜 실행을 중단한다.

4장에서 나온 동기 트랩은 인터럽트(예외)의 종류 중 하나. 하던 일을 중단하고 처리.

예외를 처리한 직후 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외. → 주로 디버깅할 때 사용.

# 캐시 메모리와 저장 장치 계층 구조의 개념

### 저장 장치 계층 구조

1. CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다.
2. 속도가 빠른 저장 장치는 저장 용량이 작고, 비싸다.

![Untitled](Chapter06%20Memory&CacheMemory%204621ca6002b84225a0e1e918ca8110eb/Untitled%203.png)

저장 장치들의 장단점이 명확하기 때문에 일반적으로 컴퓨터는 다양한 저장장치를 모두 사용한다.

CPU에 얼마나 가까운가를 기준으로 계층적으로 나타낸 것이 저장 장치 계층 구조

### 캐시 메모리

CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치. 

CPU가 메모리에 접근하는 속도는 느린데, 프로그램을 실행하는 과정에서 메모리에 빈번히 접근해야하므로 등장함.

캐시 메모리에 CPU가 필요로하는 데이터가 있다면 필요한 데이터로의 접근 시간을 줄일 수 있다.

### 캐시 메모리 종류

컴퓨터 내부에는 여러 개의 캐시 메모리가 있는데, 이들은 CPU와 가까운 순서대로 계층을 구성한다.

가장 가까운(CPU와의 접근 속도) 순으로 L1 캐시, L2 캐시, L3 캐시라고 부른다.

용량은 반대 순서이다. 보통 L1,L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.

캐시 메모리는 용량이 메모리보다 적기 때문에 CPU가 필요로 할 것 같은 대상(데이터)을 예측하여 저장한다. 예측이 맞아서 CPU가 캐시 메모리 내 데이터를 활용 할 경우 **캐시 히트**라고 부른다. 반대로 예측이 빗나가는 경우는 **캐시 미스**라고 한다.

캐시가 히트 되는 비율을 캐시 적중률이라고 하고 다음과 같이 계산한다.

![Untitled](Chapter06%20Memory&CacheMemory%204621ca6002b84225a0e1e918ca8110eb/Untitled%204.png)

적중률이 높으면 CPU의 메모리 접근 횟수를 줄일 수 있어 속도가 빨라진다.

캐시 메모리가 사용할 데이터를 예측하는 방법은 **참조 지역성의** 원리에 따라 이루어진다.

### 참조 지역성의 원리

1. 시간 지역성
CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
    
    ex) 변수에 값을 저장하고 나면 일반적으로 한 번만 사용되지 않고 프로그램이 실행되는 동안 여러번 사용된다.
    
2. 공간 지역성
CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.
ex) 하나의 프로그램 내에서도 관련 있는 데이터들은 모여서 저장된다.