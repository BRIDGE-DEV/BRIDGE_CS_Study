# Chapter08.I/ODevice

---

# 장치 컨트롤러(Device Controller)

---

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled.png)

입출력 제어기(I/O Controller), 입출력 모듈(I/O module)으로도 불림.

키보드, 모니터, 스피커, 보조기억 장치 등 다양한 입출력 장치들은 **장치 컨트롤러**를 통해 컴퓨터 내부와 소통을 한다.

장치 컨트롤러 등장 이유

- 입출력 장치는 종류가 많아서 장치마다 속도, 데이터 전송 형식 등도 다양하기 때문에
정보를 주고받는 방식을 규격화 하기 어렵다.
- 일반적으로 CPU, 메모리 보다 입출력 장치의 데이터 전송률이 낮다.

장치 컨트롤러의 역할

- CPU와 입출력 장치 간의 통신 중개
- 오류 검출
- 데이터 버퍼링

> 데이터 버퍼링이란?
> 
> 
> ![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%201.png)
> 

전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 “버퍼”라는 임시 공간에 저장하여 전송률을 비슷하게 맞추는 방법이다.

CPU → 입출력 장치 : 전송률이 높으니 조금씩 전송

입출력 장치 → CPU : 전송률이 낮으니 한 번에 전송

장치 컨트롤러의 내부 구조

- 데이터 레지스터
    - CPU와 입출력 장치 사이에 주고받을 데이터가 담김.
- 상태 레지스터
    - 작업 준비, 완료, 오류 검출 등 상태 정보가 담김.
- 제어 레지스터
    - 입출력 장치가 수행할 내용에 대한 제어 정보와 명령어가 담김.
- 상태/제어 레지스터
    - 상태, 제어는 하나의 레지스터로 사용되기도 함.

# 장치 드라이버

---

장치 컨트롤러의 동작을 감지하고 제어함으로써 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램. **번역기 역할**. 

장치를 인식하고 실행하는 주체는 **운영체제**이다. 장치 드라이버는 운영체제 기본 제공 or 장치 제작자가 따로 제공

# 입출력 방식

---

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%202.png)

CPU와 장치 컨트롤러가 정보를 주고 받는 방식.

## 프로그램 입출력 방식

- 프로그램 속 명령어로 입출력 장치를 제어하는 방법.
- 프로그램 명령어 속 입출력 명령어
    
    → CPU가 입출력 장치에 연결된 장치 컨트롤러와 상호작용 → 입출력 작업
    

1. 프린터 컨트롤러의 상태 레지스터를 읽어라.
2. 프린터 컨트롤러의 데이터 레지스터에 100을 써라.
3. 하드 디스크 컨트롤러의 데이터 레지스터에 ‘a’를 써라…

프로그램 입출력 방식은 CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이루어짐.

그럼 CPU는 그 레지스터의 주소를 어떻게 알까?

### 메모리 맵 입출력

메모리에 접근하기 위한 주소 공간과 입출력 장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 입출력 방식. 나눠 갖기.

CPU는 메모리의 주소들이나 장치 컨트롤러의 레지스터들이나 모두 똑같이 접근하면 된다.

### 고립형 입출력

메모리를 위한 주소 공간과 입출력 장치를 위한 주소 공간을 분리하는 방법.

CPU는 입출력 장치에 접근하기 위해 메모리에 접근하는 명령어와는 다른 입출력 읽기/쓰기 선을 활성화 시키는 명령어를 사용한다.

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%203.png)

## 인터럽트 기반 입출력 방식

![인터럽트](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%204.png)

인터럽트

입출력 장치에 의한 하드웨어 인터럽트는 정확히 말하자면 입출력 장치가 아닌 장치 컨트롤러에 의해서 발생한다. 

1. CPU는 장치 컨트롤러에 입출력 작업을 명령한다.  
2. 장치 컨트롤러가 입출력 장치를 제어하며 입출력을 수행하는 동안 CPU는 다른 일을 한다.
3. 장치 컨트롤러가 작업을 끝낸 뒤 CPU에게 인터럽트 요청 신호를 보낸다.
4. CPU는 하던 일을 잠시 백업하고 인터럽트 서비스 루틴을 실행한다.

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%205.png)

- 인터럽트가 동시다발적으로 일어나면 CPU 플래그 레지스터의 인터럽트 비트를 비활성화 한다면 순차적으로 해결한다.
- 반대로 인터럽트 비트를 활성화하거나, NMI가 발생한 경우 우선순위가 높은 인터럽트부터 처리한다.

### PIC(Programmable Interrupt Controller)

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%206.png)

- 우선순위를 반영하여 다중 인터럽트를 처리하는 방법 중 많은 컴퓨터에서 사용하는 방법.
- 여러 장치 컨트롤러에 연결되어 장치 컨트롤러에서 보낸 하드웨어 인터럽트들의 우선순위를 판별한 뒤 CPU에게 알려줌.
- 각 핀에는 약속된 하드웨어가 연결되어 있음.
- 더 많고 복잡한 장치들의 인터럽트를 관리하기 위해 두 개 이상의 PIC가 계층적으로 구성되기도 함.
- PIC는 NMI까지 우선순위를 판별하지 않음. 인터럽트 비트를 통해 막을 수 있는 하드웨어 인터럽트만 판별함.

## DMA(Direct Memory Access) 입출력 방식

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%207.png)

- 입출력 장치와 메모리가 CPU를 거치지 않고도 상호작용 할 수 있는 입출력 방식.
- DMA 컨트롤러라는 하드웨어가 필요하다.
- 입출력 장치와 메모리 사이에 전송되는 모든 데이터가 반드시 CPU를 거쳐야 한다면 비효율적이다. 하드 디스크 백업 같은 대용량 데이터 옮길 때는 더욱이 그렇다.

### 시스템 버스

- DMA 컨트롤러와 CPU는 시스템 버스 동시 사용이 불가능하다.
- 그래서 DMA 컨트롤러는 CPU가 시스템 버스를 이용하지 않을 때마다 조금씩 이용하거나, 일시적으로 CPU에게 허락을 구하고 시스템 버스를 집중적으로 이용하는 **사이클 스틸링**을 사용한다.

### 입출력 버스

![Untitled](Chapter08%20I%20ODevice%207391bc4d39bb4a8e82b6f50f74ddddf1/Untitled%208.png)

- DMA를 위해 시스템 버스를 너무 자주 사용하면, 그만큼 CPU가 시스템 버스를 이용하지 못한다.
- 입출력 버스라는 별도의 버스에 연결하여 해결할 수 있다.
- DMA 컨트롤러와 장치 컨트롤러가 서로 데이터를 전송할 때는 시스템 버스를 이용할 필요가 없으므로 시스템 버스의 사용 빈도를 줄일 수 있다.
- 입출력 버스는 PCI 버스, PCI Express 버스 등 여러 종류가 있다.