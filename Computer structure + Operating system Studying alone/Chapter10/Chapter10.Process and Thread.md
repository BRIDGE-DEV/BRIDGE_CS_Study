# Chapter09. 운영체제 시작하기


## 운영체제란
* 모든 프로그램은 하드웨어를 필요로 함
* 시스템 자원, 자원 : 프로그램 실행에 마땅히 필요한 요소들, 하드웨어
* 운영체제는 프로그램이므로 여느 프로그램과 마찬가지로 메모리에 적재되어야 함
* **커널 영역(Kernel Space)** : 운영체제는 특별하기 때문에 컴퓨터 부팅시, 메모리의 커널 영역에 따로 적재
* **사용자 영역(User Space)** : 커널 영역을 제외한 나머지 영역, 응용 프로그램 적재(Application Software)
  * 운영체제는 커널 영역에 적재되어 사용자 영역에 적재된 프로그램들에 자원 할당, 실행 도움
* 운영체제 사용 예시
  * 여러 프로그램을 사용할 때 메모리에 주소가 겹치지 않도록 적재
    * 실행할 프로그램을 메모리에 적재, 실행되지 않으면 삭제하며 지속적으로 메모리 자원 관리
  * 여러 프로그램이 실행되려면 CPU 필요, 어떤 프로그램이 먼저 사용할지와 얼마나 사용할지
    * 최대한 공정하게 여러 프로그램에 CPU 자원 할당
* 흔히 정부에 비유
  * 자원을 효율적으로 배분하고 규칙을 만들어 전체를 관리
  * 역할별로 부서가 나눠져있듯 관리할 자원별로 기능 분할(CPU 관리, 프로세스 관리 등)
* 운영체제가 없다면 개발자가 하드웨어를 조작하는 코드를 모두 직접 작성해야 함
  * 운영체제가 기능을 제공하기 때문에 간편하게 개발 가능
* 운영체제를 알아야하는 이유
  * 프로그램이기 때문에 개발자와 상호작용 가능
  * ex) 현재 하드웨어의 상태, 코드 실행 방식, 하드웨어상의 문제 등
  * 문제 해결의 실마리 탐색 가능, 오류 메시지 진단 가능

## 운영체제의 큰 그림

### 운영체제의 심장, 커널

#### 커널(Kernel)
* 운영체제의 핵심 서비스를 담당하는 부분
* 자원에 접근하고 조작하는 기능
* 프로그램이 올바르고 안전하게 실행되게하는 기능
* 어떤 커널을 사용하는지에 따라 자원 이용 양상, 성능의 차이 발생
* 이후 운영체제를 지칭할 때는 커널을 지칭한다 봐도 무방

#### 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스
* **사용자 인터페이스(UI; User Interface)** : 컴퓨터와 상호작용할 수 있는 통로
  * **그래픽 유저 인터페이스(GUI; Graphic User Interface)** : 그래픽을 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
  * **커맨드 라인 인터페이스(CLI; Command Line Interface)** : 명령어를 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스


### 이중 모드와 시스템 호출
* 운영체제는 사용자가 실행하는 응용프로그램이 자원에 직접 접근하는 것을 방지, 자원 보호
* 만약 직접 접근이 가능하면 컴퓨터 전체에 악영향
  * 응용프로그램들이 자원에 접근하려할 때 오직 자신을 통해서만 접근하도록 자원을 보호
* 응용프로그램들이 자원에 접근하기 위해서는 운영체제에 도움을 요청해야함

#### 이중 모드(Dual Mode)
* CPU가 명령어를 실행하는 모드를 사용자 모드와 커널 모드로 구분, 문지기 구현
* **사용자 모드(User Mode)**
  * 운영체제 서비스를 제공받을 수 없는 실행 모드, 커널 영역 코드 실행 불가
  * 일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행
  * 사용자 모드로 실행중인 CPU는 자원에 접근하는 명령어 실행 불가
  * 사용자 모드로 실행되는 일반적인 응용 프로그램은 자원 접근 불가
* **커널 모드(Kernel Mode)**
  * 운영체제 서비스를 제공받을 수 있는 실행 모드
  * 커널 영역의 코드 실행 가능
  * CPU가 커널 모드로 명령어 실행시, 자원 접근을 비롯한 모든 명령어 실행 가능
  * 운영체제는 커널모드로 실행
* CPU가 어떤 모드로 실행중인지는 4장의 슈퍼바이저 플래그 확인
* 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제의 서비스를 받으려면 운영체제에 요청을 보내 커널모드로 전환되어야 함

#### 시스템 호출 (시스템 콜, System Call)
* 운영체제 서비스를 제공받기 위한 요청
* 일종의 소프트웨어적 인터럽트
* 인터럽트를 발생시키는 특정 명령어에 의한 인터럽트 : **'소프트웨어 인터럽트'**
* CPU가 시스템 호출을 처리하는 순서는 인터럽트 처리 순서와 유사
* 시스템 호출 발생 명령어 실행 => 지금까지의 작업 백업 => 커널 영역의 수행하는 코드 실행 => 복귀
* 일반적으로 시스템 콜은 빈번하게 일어남

## 운영체제의 핵심 서비스
프로세스 관리, 자원 접근 및 할당, 파일 시스템 관리

### 프로세스 관리
* **프로세스(Process)** : 실행중인 프로그램
* 컴퓨터를 사용하는동안 메모리 안에서 새로운 프로세스 생성, 삭제
* 일반적으로 하나의 CPU는 하나의 프로세스만 실행, 조금씩 번갈아가며 실행
* 각 프로세스는 사용하는 자원과 상태가 다양함
* 그렇기 때문에 운영체제는 다양한 프로세스를 일목요연하게 관리 및 실행해야함
* 추가로 여려 프로세스가 동시에 실행되는 환경에선 **'프로세스 동기화'**가 필수적
* 프로세스가 더 이상 실행되지 못하는 **'교착상태'**를 해결해야함

### 자원 접근 및 할당
* 운영체제는 프로세스들이 사용할 자원에 접근 및 조작함으로 필요한 자원 할당
* **CPU**
  * 하나의 CPU는 하나의 프로세스만 실행, 프로세스가 CPU를 사용시 다른 프로세스는 대기
  * 이에 운영체제는 공정한 CPU할당을 위해 우선순위와 사용시간 결정
  * CPU 스케줄링이라고 함
* **메모리**
  * 같은 프로세스라 할지라도 실행마다 적재되는 주소 변경
  * 운영체제는 새로운 프로세스가 적재될 때마다 주소 결정
* **입출력장치**
  * 인터럽트 서비스 루틴은 커널 영역에 존재, 하드웨어 인터럽트도 마찬가지
  * 인터럽트 요청 신호를 보내면 백업 후 커널 영역의 인터럽트 서비스 루틴 실행
  * 운영체제는 인터럽트 처리 프로그램 제공으로 입출력 작업 수행

### 파일 시스템 관리
* 컴퓨터 사용시 파일을 열고 생성하고 삭제, 파일들을 묶어 디렉터리(폴더)로 관리
* 파일 시스템(File System)도 운영체제가 지원하는 핵심 서비스

-------

## 가상머신과 이중모드의 발전
* **가상 머신(Virtual Machine)**
  * 소프트웨어적으로 만들어낸 가상 컴퓨터, 새로운 운영체제&응용 프로그램 설치 및 실행 가능
  * 가상머신 또한 응용프로그램 => 사용자 모드로 작동, 커널 모드의 서비스 제공 어려움
  * 가상화를 지원하는 CPU는 커널모드와 사용자모드 이외에 가상머신을 위한 하이퍼 바이저 모드 지원